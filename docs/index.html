<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯›æ ¹ä¼èª¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background-color: hsl(30, 20%, 10%);
            color: hsl(45, 30%, 95%);
            min-height: 100vh;
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3) rotateY(180deg);
            }
            50% {
                opacity: 1;
                transform: scale(1.05) rotateY(0deg);
            }
            100% {
                transform: scale(1) rotateY(0deg);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 16px;
            margin-bottom: 24px;
        }

        .header-title {
            cursor: pointer;
        }

        .header-title h1 {
            font-size: 24px;
            font-weight: bold;
            color: hsl(45, 30%, 95%);
            margin-bottom: 4px;
        }

        .header-title p {
            font-size: 14px;
            color: hsl(30, 10%, 60%);
        }

        .coin-display {
            display: flex;
            align-items: center;
            gap: 8px;
            background: hsl(30, 25%, 15%);
            padding: 8px 16px;
            border-radius: 999px;
            border: 1px solid hsl(30, 20%, 25%);
        }

        .coin-display span:first-child {
            font-size: 20px;
        }

        .coin-display span:last-child {
            font-weight: bold;
            color: hsl(45, 70%, 50%);
        }

        /* Selected Hair Root Card */
        .selected-card {
            background: hsl(30, 25%, 15%);
            border-radius: 16px;
            padding: 24px;
            margin: 0 16px 24px;
            border: 1px solid hsl(30, 20%, 25%);
        }

        .selected-card h2 {
            font-size: 14px;
            color: hsl(30, 10%, 60%);
            margin-bottom: 8px;
        }

        .selected-content {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .hair-icon {
            width: 64px;
            height: 64px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
        }

        .hair-info {
            flex: 1;
        }

        .hair-info p:first-child {
            font-weight: bold;
            color: hsl(45, 30%, 95%);
            margin-bottom: 4px;
        }

        .hair-info p:nth-child(2) {
            font-size: 14px;
            color: hsl(30, 10%, 60%);
            margin-bottom: 8px;
        }

        .stats {
            display: flex;
            gap: 8px;
        }

        .stat-badge {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 4px;
            background: hsl(30, 15%, 20%);
            color: hsl(30, 10%, 70%);
        }

        /* Menu Grid */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            padding: 0 16px 24px;
        }

        .menu-button {
            position: relative;
            overflow: hidden;
            border-radius: 16px;
            padding: 24px;
            text-align: left;
            border: none;
            color: white;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .menu-button:active {
            transform: scale(0.95);
        }

        .menu-button.large {
            grid-column: 1 / -1;
        }

        .menu-button .icon-bg {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 48px;
            opacity: 0.3;
        }

        .menu-button .icon {
            font-size: 48px;
            display: block;
            margin-bottom: 8px;
        }

        .menu-button h3 {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .menu-button p {
            font-size: 14px;
            opacity: 0.8;
        }

        /* Gacha Screen */
        .gacha-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid hsl(30, 20%, 25%);
        }

        .gacha-header button {
            background: transparent;
            border: none;
            color: hsl(45, 30%, 95%);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
        }

        .gacha-header h1 {
            font-size: 20px;
            font-weight: bold;
        }

        .gacha-content {
            padding: 16px;
            min-height: calc(100vh - 60px);
            display: flex;
            flex-direction: column;
        }

        .pickup-section {
            background: linear-gradient(to right, rgba(251, 191, 36, 0.1), rgba(236, 72, 153, 0.1), rgba(251, 191, 36, 0.1));
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .pickup-section h3 {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pickup-section h3 span:first-child {
            color: #F59E0B;
        }

        .pickup-section h3 span:last-child {
            font-size: 12px;
            color: hsl(30, 10%, 60%);
        }

        .pickup-grid {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .pickup-card {
            flex-shrink: 0;
            width: 80px;
            background: hsl(30, 25%, 15%);
            border-radius: 8px;
            padding: 8px;
            border: 2px solid;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .pickup-card:hover {
            transform: scale(1.05);
        }

        .pickup-card .emoji {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .pickup-card .name {
            font-size: 10px;
            font-weight: bold;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .rates-info {
            background: hsl(30, 25%, 15%);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            border: 1px solid hsl(30, 20%, 25%);
        }

        .rates-info h3 {
            font-size: 14px;
            margin-bottom: 12px;
        }

        .rates-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 6px;
            font-size: 12px;
        }

        .rate-item {
            text-align: center;
        }

        .rate-item .dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin: 0 auto 4px;
        }

        .rate-item p:first-of-type {
            color: hsl(30, 10%, 60%);
            font-size: 10px;
            margin-bottom: 2px;
        }

        .rate-item p:last-of-type {
            font-weight: bold;
            font-size: 10px;
        }

        .pull-buttons {
            display: flex;
            gap: 16px;
            margin-top: auto;
        }

        .pull-button {
            flex: 1;
            height: 64px;
            border-radius: 8px;
            border: none;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
        }

        .pull-button:active {
            transform: scale(0.95);
        }

        .pull-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pull-button div {
            text-align: center;
        }

        .pull-button p:first-child {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .pull-button p:last-child {
            font-size: 12px;
            opacity: 0.8;
        }

        /* Gacha Results */
        .result-container {
            text-align: center;
            padding: 16px;
        }

        .result-container h2 {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 24px;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-bottom: 24px;
        }

        @media (max-width: 640px) {
            .result-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .result-card {
            background: hsl(30, 25%, 15%);
            border-radius: 8px;
            padding: 12px;
            border: 2px solid;
            text-align: center;
            cursor: pointer;
            animation: bounceIn 0.6s ease-out;
            transition: transform 0.2s;
        }

        .result-card:hover {
            transform: scale(1.05);
        }

        .result-card .emoji-box {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .result-card .name {
            font-size: 12px;
            font-weight: bold;
            line-height: 1.2;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .result-card .rarity {
            font-size: 10px;
            margin-top: 4px;
            opacity: 0.8;
        }

        .summary {
            background: hsl(30, 25%, 15%);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid hsl(30, 20%, 25%);
        }

        .summary h3 {
            font-size: 14px;
            margin-bottom: 12px;
        }

        .summary-stats {
            display: flex;
            justify-content: space-around;
            font-size: 12px;
        }

        .summary-stats > div {
            text-align: center;
        }

        .summary-stats .dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin: 0 auto 4px;
        }

        .summary-stats p {
            font-weight: bold;
            margin-top: 4px;
        }

        .result-buttons {
            display: flex;
            gap: 16px;
        }

        .btn {
            flex: 1;
            padding: 12px 24px;
            border-radius: 8px;
            border: 1px solid hsl(30, 20%, 25%);
            background: transparent;
            color: hsl(45, 30%, 95%);
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: hsl(340, 80%, 55%);
            border: none;
        }

        .btn-primary:hover:not(:disabled) {
            background: hsl(340, 80%, 50%);
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            width: 160px;
            height: 160px;
            margin: 0 auto 24px;
            background: linear-gradient(135deg, hsl(340, 80%, 55%), hsl(45, 70%, 50%));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg) scale(1);
            }
            50% {
                transform: rotate(180deg) scale(1.1);
            }
            to {
                transform: rotate(360deg) scale(1);
            }
        }

        .loading-spinner span {
            font-size: 64px;
        }

        .loading h3 {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 16px;
        }

        .loading-bar {
            width: 100%;
            max-width: 300px;
            height: 8px;
            background: hsl(30, 15%, 20%);
            border-radius: 999px;
            margin: 16px auto;
            overflow: hidden;
        }

        .loading-bar-fill {
            height: 100%;
            background: hsl(340, 80%, 55%);
            border-radius: 999px;
            animation: loadingBar 1.5s ease-in-out;
        }

        @keyframes loadingBar {
            from {
                width: 0%;
            }
            to {
                width: 100%;
            }
        }

        /* Collection Screen */
        .collection-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid hsl(30, 20%, 25%);
        }

        .collection-header button {
            background: transparent;
            border: none;
            color: hsl(45, 30%, 95%);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
        }

        .collection-progress {
            padding: 16px;
            background: hsl(30, 25%, 15%);
            border-bottom: 1px solid hsl(30, 20%, 25%);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .progress-bar {
            height: 12px;
            background: hsl(30, 15%, 20%);
            border-radius: 999px;
            overflow: hidden;
            margin-bottom: 16px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, hsl(340, 80%, 55%), hsl(45, 70%, 50%));
            transition: width 0.5s;
        }

        .rarity-progress {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 6px;
        }

        .rarity-item {
            text-align: center;
        }

        .rarity-item .dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin: 0 auto 4px;
        }

        .rarity-item p {
            font-size: 10px;
            color: hsl(30, 10%, 60%);
        }

        .collection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
            padding: 16px;
        }

        .collection-card {
            background: hsl(30, 25%, 15%);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border: 2px solid;
            transition: all 0.2s;
        }

        .collection-card:hover {
            transform: scale(1.05);
        }

        .collection-card.selected {
            background: hsl(200, 30%, 25%);
            box-shadow: 0 0 16px rgba(59, 130, 246, 0.5);
        }

        .collection-card .emoji {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .collection-card .name {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .collection-card .level {
            font-size: 10px;
            margin-bottom: 4px;
        }

        .collection-card .stats-mini {
            font-size: 9px;
            color: hsl(30, 10%, 60%);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 16px;
            animation: fadeIn 0.2s;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: hsl(30, 25%, 15%);
            border-radius: 16px;
            max-width: 400px;
            width: 100%;
            max-height: 85vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 2px solid;
            animation: bounceIn 0.3s;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 24px 16px;
        }

        .modal-badge {
            padding: 4px 12px;
            border-radius: 999px;
            font-size: 14px;
            font-weight: bold;
            color: white;
        }

        .modal-close {
            background: transparent;
            border: none;
            color: hsl(45, 30%, 95%);
            font-size: 14px;
            cursor: pointer;
            padding: 8px;
        }

        .modal-body {
            padding: 0 24px 24px;
            overflow-y: auto;
        }

        .modal-icon {
            width: 96px;
            height: 96px;
            border-radius: 16px;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
        }

        .modal-body h2 {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 8px;
        }

        .modal-body > p {
            font-size: 14px;
            color: hsl(30, 10%, 60%);
            text-align: center;
            margin-bottom: 16px;
        }

        .stats-section {
            background: hsl(30, 15%, 20%);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .stats-section h3 {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .stat-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .stat-row span:first-child {
            width: 80px;
            font-size: 12px;
            color: hsl(30, 10%, 60%);
        }

        .stat-bar {
            flex: 1;
            height: 8px;
            background: hsl(30, 20%, 10%);
            border-radius: 999px;
            overflow: hidden;
        }

        .stat-bar-fill {
            height: 100%;
            transition: width 0.3s;
        }

        .stat-row span:last-child {
            width: 40px;
            text-align: right;
            font-size: 12px;
            font-weight: bold;
        }

        /* Gradients */
        .gradient-primary-rose {
            background: linear-gradient(135deg, hsl(340, 80%, 55%), hsl(340, 70%, 45%));
        }

        .gradient-secondary-amber {
            background: linear-gradient(135deg, hsl(45, 70%, 50%), hsl(36, 70%, 50%));
        }

        .gradient-accent-emerald {
            background: linear-gradient(135deg, hsl(160, 84%, 39%), hsl(160, 70%, 35%));
        }

        .gradient-purple-fuchsia {
            background: linear-gradient(135deg, hsl(280, 60%, 60%), hsl(300, 60%, 60%));
        }

        .gradient-blue-indigo {
            background: linear-gradient(135deg, hsl(200, 90%, 55%), hsl(240, 75%, 60%));
        }

        .gradient-orange-red {
            background: linear-gradient(135deg, hsl(25, 80%, 55%), hsl(0, 80%, 55%));
        }

        /* Rarity Colors */
        .rarity-common {
            background: hsl(0, 0%, 50%);
            color: white;
        }

        .rarity-common-border {
            border-color: hsl(0, 0%, 50%) !important;
        }

        .rarity-uncommon {
            background: hsl(130, 60%, 45%);
            color: white;
        }

        .rarity-uncommon-border {
            border-color: hsl(130, 60%, 45%) !important;
        }

        .rarity-rare {
            background: hsl(210, 90%, 60%);
            color: white;
        }

        .rarity-rare-border {
            border-color: hsl(210, 90%, 60%) !important;
        }

        .rarity-epic {
            background: hsl(275, 80%, 60%);
            color: white;
        }

        .rarity-epic-border {
            border-color: hsl(275, 80%, 60%) !important;
        }

        .rarity-legendary {
            background: hsl(45, 100%, 55%);
            color: hsl(30, 20%, 10%);
        }

        .rarity-legendary-border {
            border-color: hsl(45, 100%, 55%) !important;
        }

        .rarity-cosmic {
            background: linear-gradient(135deg, hsl(45, 100%, 55%), hsl(300, 80%, 60%), hsl(200, 90%, 60%));
            color: white;
        }

        .rarity-cosmic-border {
            border-color: hsl(300, 80%, 60%) !important;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿
        const ELEMENTS = {
            fire: { name: 'ç‚', emoji: 'ğŸ”¥', color: '#EF4444' },
            water: { name: 'æ°´', emoji: 'ğŸ’§', color: '#3B82F6' },
            wind: { name: 'é¢¨', emoji: 'ğŸ’¨', color: '#22C55E' },
            light: { name: 'å…‰', emoji: 'âœ¨', color: '#FBBF24' },
            dark: { name: 'é—‡', emoji: 'ğŸŒ™', color: '#6B21A8' },
            divine: { name: 'ç¥', emoji: 'â­', color: '#F472B6' }
        };

        const HAIR_ROOTS = [
            { id: 1, name: 'ãµã‚ãµã‚æ¯›æ ¹', rarity: 'common', element: 'wind', power: 10, speed: 15, grip: 8, attack: 5, defense: 4, emoji: 'ğŸŒ±', color: '#8B4513' },
            { id: 2, name: 'ã¡ã¢ã‚Œæ¯›æ ¹', rarity: 'common', element: 'wind', power: 12, speed: 10, grip: 15, attack: 6, defense: 5, emoji: 'ğŸŒ€', color: '#654321' },
            { id: 3, name: 'ã¾ã£ã™ãæ¯›æ ¹', rarity: 'common', element: 'light', power: 11, speed: 12, grip: 11, attack: 6, defense: 5, emoji: 'ğŸ“', color: '#3D2314' },
            { id: 4, name: 'ã»ãã»ãæ¯›æ ¹', rarity: 'common', element: 'wind', power: 8, speed: 18, grip: 10, attack: 5, defense: 4, emoji: 'ğŸª¡', color: '#4A3728' },
            { id: 5, name: 'ã·ã¡ã·ã¡æ¯›æ ¹', rarity: 'common', element: 'fire', power: 9, speed: 14, grip: 12, attack: 5, defense: 5, emoji: 'ğŸ’ ', color: '#5C4033' },
            { id: 6, name: 'ã‚‚ã˜ã‚ƒã‚‚ã˜ã‚ƒæ¯›æ ¹', rarity: 'common', element: 'wind', power: 13, speed: 8, grip: 14, attack: 6, defense: 5, emoji: 'ğŸŒ¿', color: '#6B4423' },
            { id: 7, name: 'ã•ã‚‰ã•ã‚‰æ¯›æ ¹', rarity: 'common', element: 'light', power: 10, speed: 16, grip: 9, attack: 5, defense: 4, emoji: 'âœ¨', color: '#7C5A3C' },
            { id: 8, name: 'ã”ã‚ã”ã‚æ¯›æ ¹', rarity: 'common', element: 'dark', power: 15, speed: 7, grip: 13, attack: 7, defense: 6, emoji: 'ğŸª¨', color: '#5D4E37' },
            { id: 9, name: 'ã†ã­ã†ã­æ¯›æ ¹', rarity: 'common', element: 'water', power: 11, speed: 11, grip: 13, attack: 6, defense: 5, emoji: 'ğŸŒŠ', color: '#4E3B2D' },
            { id: 10, name: 'ã´ã‚“ã´ã‚“æ¯›æ ¹', rarity: 'common', element: 'light', power: 12, speed: 13, grip: 10, attack: 6, defense: 5, emoji: 'âš¡', color: '#5F4B3C' },
            { id: 11, name: 'éŠ€ã®æ¯›æ ¹', rarity: 'uncommon', element: 'light', power: 18, speed: 20, grip: 17, attack: 14, defense: 12, emoji: 'ğŸª™', color: '#C0C0C0' },
            { id: 12, name: 'ãƒ„ã‚¤ã‚¹ãƒˆæ¯›æ ¹', rarity: 'uncommon', element: 'wind', power: 20, speed: 16, grip: 22, attack: 15, defense: 13, emoji: 'ğŸ§¬', color: '#8B6914' },
            { id: 13, name: 'ã‚¢ãƒ³ã‚«ãƒ¼æ¯›æ ¹', rarity: 'uncommon', element: 'water', power: 22, speed: 12, grip: 25, attack: 16, defense: 15, emoji: 'âš“', color: '#4A5568' },
            { id: 14, name: 'ã‚¹ãƒ—ãƒªãƒ³ã‚°æ¯›æ ¹', rarity: 'uncommon', element: 'wind', power: 15, speed: 28, grip: 15, attack: 12, defense: 10, emoji: 'ğŸ¯', color: '#718096' },
            { id: 15, name: 'ãƒ•ãƒ¬ã‚¤ãƒ æ¯›æ ¹', rarity: 'uncommon', element: 'fire', power: 25, speed: 18, grip: 14, attack: 18, defense: 11, emoji: 'ğŸ”¥', color: '#EF4444' },
            { id: 16, name: 'ãƒ•ãƒ­ã‚¹ãƒˆæ¯›æ ¹', rarity: 'uncommon', element: 'water', power: 16, speed: 22, grip: 20, attack: 13, defense: 14, emoji: 'â„ï¸', color: '#60A5FA' },
            { id: 17, name: 'ã‚µãƒ³ãƒ€ãƒ¼æ¯›æ ¹', rarity: 'uncommon', element: 'light', power: 24, speed: 24, grip: 10, attack: 17, defense: 9, emoji: 'âš¡', color: '#FBBF24' },
            { id: 18, name: 'ãƒã‚¤ãƒ³æ¯›æ ¹', rarity: 'uncommon', element: 'wind', power: 14, speed: 15, grip: 30, attack: 11, defense: 17, emoji: 'ğŸŒ¿', color: '#10B981' },
            { id: 19, name: 'é‡‘ã®æ¯›æ ¹', rarity: 'rare', element: 'light', power: 30, speed: 28, grip: 28, attack: 26, defense: 24, emoji: 'ğŸ¥‡', color: '#FFD700' },
            { id: 20, name: 'ãƒ‰ãƒ©ã‚´ãƒ³æ¯›æ ¹', rarity: 'rare', element: 'fire', power: 38, speed: 25, grip: 25, attack: 32, defense: 22, emoji: 'ğŸ‰', color: '#DC2626' },
            { id: 21, name: 'ã‚¯ãƒªã‚¹ã‚¿ãƒ«æ¯›æ ¹', rarity: 'rare', element: 'water', power: 28, speed: 32, grip: 30, attack: 25, defense: 27, emoji: 'ğŸ’', color: '#06B6D4' },
            { id: 22, name: 'ã‚·ãƒ£ãƒ‰ã‚¦æ¯›æ ¹', rarity: 'rare', element: 'dark', power: 32, speed: 35, grip: 22, attack: 28, defense: 20, emoji: 'ğŸŒ‘', color: '#1F2937' },
            { id: 23, name: 'ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼æ¯›æ ¹', rarity: 'rare', element: 'light', power: 28, speed: 28, grip: 35, attack: 24, defense: 30, emoji: 'ğŸŒˆ', color: '#EC4899' },
            { id: 24, name: 'ãƒ¡ã‚¿ãƒ«æ¯›æ ¹', rarity: 'rare', element: 'dark', power: 40, speed: 18, grip: 32, attack: 33, defense: 29, emoji: 'ğŸ”©', color: '#6B7280' },
            { id: 25, name: 'é³³å‡°æ¯›æ ¹', rarity: 'epic', element: 'fire', power: 48, speed: 45, grip: 42, attack: 45, defense: 38, emoji: 'ğŸ¦…', color: '#F97316' },
            { id: 26, name: 'æ·±æµ·æ¯›æ ¹', rarity: 'epic', element: 'water', power: 42, speed: 38, grip: 55, attack: 40, defense: 48, emoji: 'ğŸ™', color: '#1E3A8A' },
            { id: 27, name: 'ãƒãƒ“ãƒ¥ãƒ©æ¯›æ ¹', rarity: 'epic', element: 'divine', power: 50, speed: 48, grip: 38, attack: 48, defense: 40, emoji: 'ğŸŒŒ', color: '#7C3AED' },
            { id: 28, name: 'ã‚¿ã‚¤ãƒ ãƒªãƒ¼ãƒ—æ¯›æ ¹', rarity: 'epic', element: 'light', power: 45, speed: 55, grip: 40, attack: 43, defense: 35, emoji: 'â°', color: '#0EA5E9' },
            { id: 29, name: 'ç¥ã®æ¯›æ ¹', rarity: 'legendary', element: 'divine', power: 70, speed: 65, grip: 68, attack: 70, defense: 68, emoji: 'ğŸ‘‘', color: '#FDE047' },
            { id: 30, name: 'ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«æ¯›æ ¹', rarity: 'legendary', element: 'dark', power: 75, speed: 60, grip: 75, attack: 75, defense: 72, emoji: 'ğŸ•³ï¸', color: '#18181B' },
            { id: 31, name: 'ã‚¼ã‚¦ã‚¹ã®æ¯›æ ¹', rarity: 'cosmic', element: 'divine', power: 100, speed: 95, grip: 90, attack: 95, defense: 92, emoji: 'âš¡', color: '#FFD700' },
            { id: 32, name: 'ã‚®ãƒ£ãƒ©ã‚¯ãƒ†ã‚£ã‚«æ¯›æ ¹', rarity: 'cosmic', element: 'dark', power: 105, speed: 90, grip: 95, attack: 100, defense: 95, emoji: 'ğŸŒŒ', color: '#4B0082' },
            { id: 33, name: 'ã­ã°ã­ã°æ¯›æ ¹', rarity: 'common', element: 'water', power: 9, speed: 10, grip: 18, attack: 5, defense: 6, emoji: 'ğŸ¯', color: '#D97706' },
            { id: 34, name: 'ã¨ã’ã¨ã’æ¯›æ ¹', rarity: 'common', element: 'wind', power: 16, speed: 9, grip: 10, attack: 7, defense: 4, emoji: 'ğŸŒµ', color: '#16A34A' },
            { id: 35, name: 'ãµã«ã‚ƒãµã«ã‚ƒæ¯›æ ¹', rarity: 'common', element: 'water', power: 8, speed: 17, grip: 11, attack: 5, defense: 5, emoji: 'ğŸª¼', color: '#A78BFA' },
            { id: 36, name: 'ã½ã‚ˆã½ã‚ˆæ¯›æ ¹', rarity: 'common', element: 'water', power: 10, speed: 12, grip: 14, attack: 5, defense: 6, emoji: 'ğŸ«§', color: '#38BDF8' },
            { id: 37, name: 'ãã‚‰ãã‚‰æ¯›æ ¹', rarity: 'common', element: 'light', power: 11, speed: 14, grip: 10, attack: 6, defense: 5, emoji: 'ğŸ’«', color: '#FCD34D' },
            { id: 38, name: 'ãƒã‚°ãƒæ¯›æ ¹', rarity: 'uncommon', element: 'fire', power: 28, speed: 14, grip: 16, attack: 20, defense: 10, emoji: 'ğŸŒ‹', color: '#DC2626' },
            { id: 39, name: 'ã‚¦ã‚£ãƒ³ãƒ‰æ¯›æ ¹', rarity: 'uncommon', element: 'wind', power: 16, speed: 30, grip: 12, attack: 13, defense: 9, emoji: 'ğŸŒ¬ï¸', color: '#67E8F9' },
            { id: 40, name: 'ã‚°ãƒ©ãƒ“ãƒ†ã‚£æ¯›æ ¹', rarity: 'uncommon', element: 'dark', power: 24, speed: 15, grip: 20, attack: 17, defense: 14, emoji: 'ğŸ”®', color: '#8B5CF6' },
            { id: 41, name: 'ãƒã‚¤ã‚ºãƒ³æ¯›æ ¹', rarity: 'uncommon', element: 'dark', power: 22, speed: 20, grip: 18, attack: 16, defense: 12, emoji: 'â˜ ï¸', color: '#84CC16' },
            { id: 42, name: 'ã‚½ãƒ‹ãƒƒã‚¯æ¯›æ ¹', rarity: 'uncommon', element: 'wind', power: 18, speed: 32, grip: 10, attack: 14, defense: 8, emoji: 'ğŸ’¨', color: '#6366F1' },
            { id: 43, name: 'ã‚ªãƒ¼ãƒ­ãƒ©æ¯›æ ¹', rarity: 'rare', element: 'light', power: 32, speed: 30, grip: 28, attack: 28, defense: 26, emoji: 'ğŸŒŒ', color: '#34D399' },
            { id: 44, name: 'ãƒ«ãƒŠæ¯›æ ¹', rarity: 'rare', element: 'dark', power: 28, speed: 35, grip: 30, attack: 25, defense: 28, emoji: 'ğŸŒ™', color: '#E2E8F0' },
            { id: 45, name: 'ã‚½ãƒ¼ãƒ©ãƒ¼æ¯›æ ¹', rarity: 'rare', element: 'light', power: 40, speed: 28, grip: 25, attack: 34, defense: 22, emoji: 'â˜€ï¸', color: '#FBBF24' },
            { id: 46, name: 'ã‚¹ãƒ”ãƒªãƒƒãƒˆæ¯›æ ¹', rarity: 'rare', element: 'divine', power: 30, speed: 32, grip: 32, attack: 27, defense: 30, emoji: 'ğŸ‘»', color: '#A78BFA' },
            { id: 47, name: 'ãƒ†ãƒ©æ¯›æ ¹', rarity: 'rare', element: 'dark', power: 38, speed: 22, grip: 35, attack: 31, defense: 32, emoji: 'ğŸ”ï¸', color: '#92400E' },
            { id: 48, name: 'ã‚±ãƒ«ãƒ™ãƒ­ã‚¹æ¯›æ ¹', rarity: 'epic', element: 'fire', power: 52, speed: 42, grip: 45, attack: 50, defense: 40, emoji: 'ğŸ•', color: '#7C2D12' },
            { id: 49, name: 'ãƒ´ã‚¡ãƒ«ã‚­ãƒªãƒ¼æ¯›æ ¹', rarity: 'epic', element: 'light', power: 48, speed: 50, grip: 42, attack: 46, defense: 42, emoji: 'âš”ï¸', color: '#F472B6' },
            { id: 50, name: 'ãƒªãƒ´ã‚¡ã‚¤ã‚¢ã‚µãƒ³æ¯›æ ¹', rarity: 'epic', element: 'water', power: 45, speed: 40, grip: 55, attack: 42, defense: 50, emoji: 'ğŸ‹', color: '#0369A1' },
            { id: 51, name: 'ã‚ªãƒ¼ãƒ‡ã‚£ãƒ³æ¯›æ ¹', rarity: 'legendary', element: 'divine', power: 72, speed: 68, grip: 65, attack: 72, defense: 70, emoji: 'ğŸ¦…', color: '#1E40AF' },
            { id: 52, name: 'ã‚¢ãƒãƒ†ãƒ©ã‚¹æ¯›æ ¹', rarity: 'legendary', element: 'light', power: 68, speed: 70, grip: 70, attack: 68, defense: 70, emoji: 'ğŸŒ¸', color: '#F43F5E' },
            { id: 53, name: 'è¶…æ¬¡å…ƒæ¯›æ ¹é­”ç‹ãƒ˜ã‚¢ã‚°ãƒ©ãƒ³ãƒ‰', rarity: 'cosmic', element: 'dark', power: 100, speed: 100, grip: 100, attack: 100, defense: 100, emoji: 'ğŸ‘‘', color: '#FF1493' },
        ];

        const RARITY_RATES = {
            common: { rate: 0.499, color: 'hsl(0, 0%, 50%)' },
            uncommon: { rate: 0.30, color: 'hsl(130, 60%, 45%)' },
            rare: { rate: 0.14, color: 'hsl(210, 90%, 60%)' },
            epic: { rate: 0.05, color: 'hsl(275, 80%, 60%)' },
            legendary: { rate: 0.01, color: 'hsl(45, 100%, 55%)' },
            cosmic: { rate: 0.001, color: 'hsl(300, 80%, 60%)' }
        };

        const RARITY_NAMES = {
            common: 'ãƒãƒ¼ãƒãƒ«',
            uncommon: 'ãƒ˜ã‚¢',
            rare: 'ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ˜ã‚¢',
            epic: 'ã‚¦ãƒ«ãƒˆãƒ©ãƒ˜ã‚¢',
            legendary: 'ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰ãƒ˜ã‚¢',
            cosmic: 'ã‚³ã‚ºãƒŸãƒƒã‚¯ãƒ˜ã‚¢'
        };

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let gameState = {
            coins: 100,
            collection: [],
            selectedHairRoot: null,
            playerName: 'No Name',
            playerTitle: 'é§†ã‘å‡ºã—è‚²æ¯›å£«'
        };

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿
        function loadGameState() {
            const saved = localStorage.getItem('hairBattleGame');
            if (saved) {
                const parsed = JSON.parse(saved);
                gameState = { ...gameState, ...parsed };
                // é¸æŠã•ã‚ŒãŸæ¯›æ ¹ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯æœ€åˆã®æ¯›æ ¹ã‚’é¸æŠ
                if (!gameState.selectedHairRoot && gameState.collection.length > 0) {
                    gameState.selectedHairRoot = gameState.collection[0];
                }
            }
        }

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
        function saveGameState() {
            localStorage.setItem('hairBattleGame', JSON.stringify(gameState));
        }

        // ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã«åŸºã¥ãã‚¬ãƒãƒ£
        function pullGacha(count = 1) {
            const results = [];
            for (let i = 0; i < count; i++) {
                const rand = Math.random();
                let cumulativeRate = 0;
                let selectedRarity = 'common';
                
                for (const [rarity, data] of Object.entries(RARITY_RATES)) {
                    cumulativeRate += data.rate;
                    if (rand < cumulativeRate) {
                        selectedRarity = rarity;
                        break;
                    }
                }
                
                const hairsOfRarity = HAIR_ROOTS.filter(h => h.rarity === selectedRarity);
                const randomHair = hairsOfRarity[Math.floor(Math.random() * hairsOfRarity.length)];
                
                results.push({
                    ...randomHair,
                    level: 1,
                    exp: 0,
                    uniqueId: Date.now() + i
                });
            }
            return results;
        }

        // ç”»é¢è¡¨ç¤º
        let currentScreen = 'home';

        function showScreen(screenName) {
            currentScreen = screenName;
            render();
        }

        // ãƒ›ãƒ¼ãƒ ç”»é¢
        function renderHomeScreen() {
            const selected = gameState.selectedHairRoot || gameState.collection[0];
            const rarityClass = selected ? `rarity-${selected.rarity}` : 'rarity-common';
            
            return `
                <div class="screen active">
                    <div class="header">
                        <div class="header-title" onclick="showScreen('home')">
                            <h1>æ¯›æ ¹ä¼èª¬</h1>
                            <p>${gameState.playerName} / ${gameState.playerTitle}</p>
                        </div>
                        <div class="coin-display">
                            <span>ğŸª™</span>
                            <span>${gameState.coins}</span>
                        </div>
                    </div>
                    
                    ${selected ? `
                    <div class="selected-card">
                        <h2>é¸æŠä¸­ã®æ¯›æ ¹</h2>
                        <div class="selected-content">
                            <div class="hair-icon ${rarityClass}">${selected.emoji}</div>
                            <div class="hair-info">
                                <p>${selected.name}</p>
                                <p>Lv.${selected.level} ${RARITY_NAMES[selected.rarity]}</p>
                                <div class="stats">
                                    <span class="stat-badge">${ELEMENTS[selected.element].emoji}${ELEMENTS[selected.element].name}</span>
                                    <span class="stat-badge">ğŸ’ª${selected.power}</span>
                                    <span class="stat-badge">ğŸƒ${selected.speed}</span>
                                    <span class="stat-badge">ğŸ”—${selected.grip}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    ` : ''}
                    
                    <div class="menu-grid">
                        <button class="menu-button large gradient-primary-rose" onclick="showScreen('gacha')">
                            <span class="icon-bg">ğŸ°</span>
                            <span class="icon">ğŸ°</span>
                            <h3>è„±æ¯›ã‚¬ãƒãƒ£</h3>
                            <p>æ–°ã—ã„æ¯›æ ¹ã‚’å¬å–š</p>
                        </button>
                        
                        <button class="menu-button gradient-secondary-amber" onclick="showScreen('collection')">
                            <span class="icon-bg">ğŸ“š</span>
                            <span class="icon">ğŸ“š</span>
                            <h3>ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</h3>
                            <p>æ¯›æ ¹ã‚’ç®¡ç†</p>
                        </button>
                        
                        <button class="menu-button gradient-accent-emerald" onclick="alert('ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã¯é–‹ç™ºä¸­ã§ã™')">
                            <span class="icon-bg">ğŸ’ª</span>
                            <span class="icon">ğŸ’ª</span>
                            <h3>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h3>
                            <p>è‚²æˆã—ã¦å¼·åŒ–</p>
                        </button>
                        
                        <button class="menu-button gradient-purple-fuchsia" onclick="alert('ãƒãƒˆãƒ«ã¯é–‹ç™ºä¸­ã§ã™')">
                            <span class="icon-bg">âš”ï¸</span>
                            <span class="icon">âš”ï¸</span>
                            <h3>ãƒãƒˆãƒ«</h3>
                            <p>1å¯¾1ã®å¯¾æ±º</p>
                        </button>
                        
                        <button class="menu-button gradient-blue-indigo" onclick="alert('ãƒãƒˆãƒ«ãƒ­ãƒ¯ã‚¤ãƒ¤ãƒ«ã¯é–‹ç™ºä¸­ã§ã™')">
                            <span class="icon-bg">ğŸ‘¥</span>
                            <span class="icon">ğŸ‘¥</span>
                            <h3>ãƒãƒˆãƒ«ãƒ­ãƒ¯ã‚¤ãƒ¤ãƒ«</h3>
                            <p>æœ€å¾Œã®ç”Ÿãæ®‹ã‚Š</p>
                        </button>
                        
                        <button class="menu-button gradient-orange-red" onclick="alert('ãƒãƒ¼ãƒ ãƒ­ãƒ¯ã‚¤ãƒ¤ãƒ«ã¯é–‹ç™ºä¸­ã§ã™')">
                            <span class="icon-bg">ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦</span>
                            <span class="icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦</span>
                            <h3>ãƒãƒ¼ãƒ ãƒ­ãƒ¯ã‚¤ãƒ¤ãƒ«</h3>
                            <p>3å¯¾3ã®ãƒãƒ¼ãƒ æˆ¦</p>
                        </button>
                    </div>
                </div>
            `;
        }

        // ã‚¬ãƒãƒ£ç”»é¢
        let gachaState = 'idle'; // idle, pulling, results
        let gachaResults = [];

        function renderGachaScreen() {
            if (gachaState === 'pulling') {
                return `
                    <div class="screen active">
                        <div class="loading">
                            <div class="loading-spinner">
                                <span>ğŸ°</span>
                            </div>
                            <h3>æ¯›æ ¹å¬å–šä¸­...</h3>
                            <div class="loading-bar">
                                <div class="loading-bar-fill"></div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            if (gachaState === 'results') {
                const rarityCounts = {};
                gachaResults.forEach(hair => {
                    rarityCounts[hair.rarity] = (rarityCounts[hair.rarity] || 0) + 1;
                });
                
                return `
                    <div class="screen active">
                        <div class="result-container">
                            <h2>âœ¨ å¬å–šçµæœ âœ¨</h2>
                            
                            <div class="result-grid">
                                ${gachaResults.map((hair, idx) => `
                                    <div class="result-card rarity-${hair.rarity}-border" style="animation-delay: ${idx * 0.1}s">
                                        <div class="emoji-box rarity-${hair.rarity}">${hair.emoji}</div>
                                        <div class="name">${hair.name}</div>
                                        <div class="rarity">${RARITY_NAMES[hair.rarity]}</div>
                                        <div style="font-size: 10px; margin-top: 2px;">${ELEMENTS[hair.element].emoji}${ELEMENTS[hair.element].name}</div>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div class="summary">
                                <h3>ãƒ¬ã‚¢ãƒªãƒ†ã‚£å†…è¨³</h3>
                                <div class="summary-stats">
                                    ${Object.entries(RARITY_RATES).map(([rarity, data]) => `
                                        <div>
                                            <div class="dot rarity-${rarity}"></div>
                                            <p>${rarityCounts[rarity] || 0}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="result-buttons">
                                <button class="btn" onclick="gachaState = 'idle'; render();">ã‚‚ã†ä¸€åº¦</button>
                                <button class="btn btn-primary" onclick="showScreen('collection')">ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã‚‹</button>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—æ¯›æ ¹ï¼ˆãƒ¬ã‚¸ã‚§ãƒ³ãƒ€ãƒªãƒ¼ã¨ã‚³ã‚ºãƒŸãƒƒã‚¯ã®ã¿ï¼‰
            const pickupHairs = HAIR_ROOTS.filter(h => h.rarity === 'legendary' || h.rarity === 'cosmic');
            
            return `
                <div class="screen active">
                    <div class="gacha-header">
                        <button onclick="showScreen('home')">â†</button>
                        <h1>è„±æ¯›ã‚¬ãƒãƒ£</h1>
                        <div class="coin-display">
                            <span>ğŸª™</span>
                            <span>${gameState.coins}</span>
                        </div>
                    </div>
                    
                    <div class="gacha-content">
                        <div class="pickup-section">
                            <h3>
                                <span>â˜…</span>
                                <span>ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—</span>
                            </h3>
                            <div class="pickup-grid">
                                ${pickupHairs.map(hair => `
                                    <div class="pickup-card rarity-${hair.rarity}-border">
                                        <div class="emoji">${hair.emoji}</div>
                                        <div class="name">${hair.name}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="rates-info">
                            <h3>æ’å‡ºç‡</h3>
                            <div class="rates-grid">
                                ${Object.entries(RARITY_RATES).map(([rarity, data]) => `
                                    <div class="rate-item">
                                        <div class="dot rarity-${rarity}"></div>
                                        <p>${RARITY_NAMES[rarity]}</p>
                                        <p>${(data.rate * 100).toFixed(1)}%</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="pull-buttons">
                            <button class="pull-button gradient-secondary-amber" 
                                    onclick="handlePull(1)" 
                                    ${gameState.coins < 10 ? 'disabled' : ''}>
                                <div>
                                    <p>å˜ç™º</p>
                                    <p>ğŸª™ 10</p>
                                </div>
                            </button>
                            <button class="pull-button gradient-primary-rose" 
                                    onclick="handlePull(10)"
                                    ${gameState.coins < 100 ? 'disabled' : ''}>
                                <div>
                                    <p>10é€£</p>
                                    <p>ğŸª™ 100</p>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function handlePull(count) {
            const cost = count * 10;
            if (gameState.coins < cost) {
                alert('ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šã¾ã›ã‚“ï¼');
                return;
            }
            
            gameState.coins -= cost;
            gachaState = 'pulling';
            render();
            
            setTimeout(() => {
                gachaResults = pullGacha(count);
                gameState.collection.push(...gachaResults);
                
                if (!gameState.selectedHairRoot) {
                    gameState.selectedHairRoot = gachaResults[0];
                }
                
                saveGameState();
                gachaState = 'results';
                render();
            }, 1500);
        }

        // ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç”»é¢
        function renderCollectionScreen() {
            const totalHairs = HAIR_ROOTS.length;
            const uniqueCollection = new Set(gameState.collection.map(h => h.id));
            const collectedCount = uniqueCollection.size;
            const progress = (collectedCount / totalHairs * 100).toFixed(1);
            
            // ãƒ¬ã‚¢ãƒªãƒ†ã‚£åˆ¥ã‚«ã‚¦ãƒ³ãƒˆ
            const rarityProgress = {};
            Object.keys(RARITY_RATES).forEach(rarity => {
                const totalOfRarity = HAIR_ROOTS.filter(h => h.rarity === rarity).length;
                const collectedOfRarity = [...uniqueCollection].filter(id => {
                    const hair = HAIR_ROOTS.find(h => h.id === id);
                    return hair && hair.rarity === rarity;
                }).length;
                rarityProgress[rarity] = `${collectedOfRarity}/${totalOfRarity}`;
            });
            
            // ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤ºç”¨ã«å¤‰æ›
            const displayCollection = Array.from(uniqueCollection).map(id => {
                const original = HAIR_ROOTS.find(h => h.id === id);
                const owned = gameState.collection.filter(h => h.id === id);
                const bestLevel = Math.max(...owned.map(h => h.level));
                return { ...original, level: bestLevel, count: owned.length };
            });
            
            return `
                <div class="screen active">
                    <div class="collection-header">
                        <button onclick="showScreen('home')">â†</button>
                        <h1>ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</h1>
                        <div class="coin-display">
                            <span>ğŸª™</span>
                            <span>${gameState.coins}</span>
                        </div>
                    </div>
                    
                    <div class="collection-progress">
                        <div class="progress-header">
                            <span>åé›†é€²æ—</span>
                            <span>${collectedCount} / ${totalHairs}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <div class="rarity-progress">
                            ${Object.entries(RARITY_RATES).map(([rarity]) => `
                                <div class="rarity-item">
                                    <div class="dot rarity-${rarity}"></div>
                                    <p>${rarityProgress[rarity]}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="collection-grid">
                        ${displayCollection.length === 0 ? `
                            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: hsl(30, 10%, 60%);">
                                <p style="font-size: 48px; margin-bottom: 16px;">ğŸ“¦</p>
                                <p>ã¾ã æ¯›æ ¹ã‚’æŒã£ã¦ã„ã¾ã›ã‚“</p>
                                <p style="font-size: 14px; margin-top: 8px;">ã‚¬ãƒãƒ£ã§æ¯›æ ¹ã‚’å¬å–šã—ã¾ã—ã‚‡ã†ï¼</p>
                            </div>
                        ` : displayCollection.map(hair => {
                            const isSelected = gameState.selectedHairRoot && gameState.selectedHairRoot.id === hair.id;
                            return `
                                <div class="collection-card rarity-${hair.rarity}-border ${isSelected ? 'selected' : ''}" 
                                     onclick="selectHair(${hair.id})">
                                    <div class="emoji">${hair.emoji}</div>
                                    <div class="name">${hair.name}</div>
                                    <div class="level">Lv.${hair.level} x${hair.count}</div>
                                    <div class="stats-mini">${ELEMENTS[hair.element].emoji} ğŸ’ª${hair.power} ğŸƒ${hair.speed} ğŸ”—${hair.grip}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function selectHair(hairId) {
            const hair = gameState.collection.find(h => h.id === hairId);
            if (hair) {
                gameState.selectedHairRoot = hair;
                saveGameState();
                render();
            }
        }

        // ãƒ¡ã‚¤ãƒ³ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function render() {
            const app = document.getElementById('app');
            let html = '';
            
            switch (currentScreen) {
                case 'home':
                    html = renderHomeScreen();
                    break;
                case 'gacha':
                    html = renderGachaScreen();
                    break;
                case 'collection':
                    html = renderCollectionScreen();
                    break;
                default:
                    html = renderHomeScreen();
            }
            
            app.innerHTML = html;
        }

        // åˆæœŸåŒ–
        loadGameState();
        render();
    </script>
</body>
</html>
